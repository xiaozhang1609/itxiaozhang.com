---
title: æ‰¹é‡å›¾ç‰‡å»æ°´å°ï¼šä½¿ç”¨ IOPaint å®ç°å›ºå®šæ©è†œæ‰¹é‡å»é™¤å›¾ç‰‡æ°´å°
url: /iopaint-fixed-mask-batch-inpainting-cpu/
date: '2025-05-19 18:27:22 +0800'
description: ä½¿ç”¨ IOPaint CLI å’Œå›ºå®šæ©è†œå›¾ï¼Œåœ¨ CPU ç¯å¢ƒä¸‹å®ç°å›¾ç‰‡æ°´å°çš„æ‰¹é‡è‡ªåŠ¨å»é™¤ï¼Œå…¼é¡¾é«˜æ•ˆç‡ä¸ä½é—¨æ§›ï¼Œé€‚ç”¨äºæ—  GPU ç”¨æˆ·çš„å›¾åƒå¤„ç†éœ€æ±‚ã€‚
categories:
  - ç¼–ç¨‹å¼€å‘
tags:
  - æ‰¹é‡å¤„ç†
  - iopaint
  - æ°´å°
  - python
author: ITå°ç« 
---

> åŸæ–‡åœ°å€ï¼š<https://itxiaozhang.com/iopaint-fixed-mask-batch-inpainting-cpu/>  
> å¦‚æœæ‚¨éœ€è¦è¿œç¨‹ç”µè„‘ç»´ä¿®æˆ–è€…ç¼–ç¨‹å¼€å‘ï¼Œè¯·[åŠ æˆ‘å¾®ä¿¡](https://zhang9.cn)å’¨è¯¢ã€‚

## ä¸€ã€éœ€æ±‚åˆ†æ

åœ¨æ‰¹é‡å¤„ç†å›¾ç‰‡çš„å®é™…å·¥ä½œä¸­ï¼Œå¸¸ä¼šé‡åˆ°ç»Ÿä¸€ä½ç½®çš„æ°´å°ï¼ˆå¦‚é¡¶éƒ¨ç¼–å·ã€åº•éƒ¨æ ‡è¯†ç­‰ï¼‰ã€‚æ‰‹åŠ¨æ“¦é™¤æ•ˆç‡ä½ï¼Œå€ŸåŠ© AI å›¾åƒä¿®å¤å·¥å…·å¦‚ IOPaintï¼ˆåŸ Lama Cleanerï¼‰å¯å®ç°è‡ªåŠ¨åŒ–å¤„ç†ã€‚ç„¶è€Œå…¶é»˜è®¤ä½¿ç”¨ Web ç•Œé¢ï¼Œä¸èƒ½ç›´æ¥æ‰¹å¤„ç†ï¼Œå› æ­¤æœ¬æ–‡ç›®æ ‡æ˜¯ï¼š

- **æ‰¹é‡å¤„ç†æ•´ç›®å½•å›¾ç‰‡**
- **ä½¿ç”¨ä¸€ä¸ªå›ºå®šæ©è†œå»é™¤ç›¸åŒæ°´å°ä½ç½®**
- **å…¨è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€äº¤äº’æ“ä½œ**
- **ä½¿ç”¨ CPUï¼Œå…¼å®¹æ‰€æœ‰æ™®é€šç”µè„‘**
- **è¾“å‡ºä¿æŒåŸåˆ†è¾¨ç‡ä¸æ–‡ä»¶å**
- **ç”Ÿæˆå®Œæ•´å¤„ç†æ—¥å¿—**

---

## äºŒã€è§£å†³æ€è·¯

### 1. å·¥å…·é€‰æ‹©

ä½¿ç”¨å¼€æºå›¾åƒä¿®å¤å·¥å…· [IOPaint](https://github.com/Sanster/IOPaint)ï¼Œæ”¯æŒå‘½ä»¤è¡Œè°ƒç”¨ä¸ AI ä¿®å¤æ¨¡å‹ï¼ˆé»˜è®¤ lamaï¼‰ï¼Œé€‚åˆå›¾åƒ inpainting ä»»åŠ¡ï¼Œå…¼å®¹ CPU å’Œ GPUã€‚

### 2. æ‰§è¡Œæµç¨‹

- å®‰è£… Python ä¸ IOPaint CLI
- ä½¿ç”¨ Lama Cleaner åœ¨çº¿ç‰ˆæ‰‹åŠ¨ç”Ÿæˆç»Ÿä¸€çš„æ©è†œå›¾
- ç”¨ Python è„šæœ¬æ‰¹é‡æ‰§è¡Œ CLI å‘½ä»¤
- æ”¯æŒå¤šè¿›ç¨‹å¹¶å‘ï¼ŒåŠ é€Ÿ CPU å¤„ç†

---

## ä¸‰ã€æ©è†œæ–‡ä»¶å‡†å¤‡ä¸ä¼˜åŒ–

### 1. æ©è†œåˆ¶ä½œ

æ‰“å¼€ [Lama Cleaner Hugging Face é¡µé¢](https://huggingface.co/spaces/Sanster/Lama-Cleaner-lama)ï¼ŒåŠ è½½ä»»æ„ä¸€å¼ å›¾ï¼Œè¿›è¡Œæ©è†œç»˜åˆ¶ï¼š

- å‹¾é€‰ã€ŒDownload Maskã€
- å‹¾é€‰ã€ŒManual Inpainting Modeã€
- ç”¨ç”»ç¬”æ¡†é€‰éœ€è¦å»é™¤çš„æ°´å°åŒºåŸŸ
- ç‚¹å‡»ã€ŒDownload Maskã€æŒ‰é’®ä¸‹è½½æ©è†œå›¾

æ©è†œå›¾ä¸åŸå›¾å°ºå¯¸ä¸€è‡´ï¼Œç™½è‰²åŒºåŸŸä¸ºéœ€ä¿®å¤éƒ¨åˆ†ã€‚

### 2. æ©è†œè¦æ±‚

- ä¿å­˜ä¸º `fixed_mask.jpg`ï¼Œä¸åŸå›¾å°ºå¯¸ç›¸åŒï¼ˆå¦‚ 960x8049ï¼‰
- ç™½è‰²åŒºåŸŸè¡¨ç¤ºéœ€è¦ä¿®å¤ï¼Œé»‘è‰²ä¿ç•™ä¸å˜
- æ©è†œåº”ç»Ÿä¸€åº”ç”¨äºæ‰€æœ‰å›¾åƒ

---

## å››ã€è„šæœ¬å¼€å‘ä¸å¹¶è¡Œä¼˜åŒ–ï¼ˆä»…ä½¿ç”¨ CPUï¼‰

ä¸ºæå‡æ‰¹é‡å¤„ç†æ•ˆç‡ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªæ”¯æŒå¤šè¿›ç¨‹å¹¶å‘çš„ Python è„šæœ¬ã€‚è™½ç„¶è¿è¡Œåœ¨ CPU ä¸Šï¼Œä½†å¹¶è¡Œä»èƒ½æ˜¾è‘—æé€Ÿã€‚

### ğŸ“ æ–‡ä»¶ç»“æ„

```

é¡¹ç›®ç›®å½•/
â”œâ”€ input/              # åŸå§‹å›¾ç‰‡ç›®å½•
â”œâ”€ output/             # è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€ fixed\_mask.jpg      # æ©è†œå›¾
â”œâ”€ parallel\_iopaint.py # ä¸»æ‰§è¡Œè„šæœ¬

````

### ğŸ“œ è„šæœ¬æ ¸å¿ƒå†…å®¹ï¼ˆç®€è¦ï¼‰

- éå† `input/` ç›®å½•ä¸­çš„å›¾ç‰‡
- ä¸ºæ¯å¼ å›¾è°ƒç”¨ IOPaint CLI å‘½ä»¤è¡Œå·¥å…·
- ä½¿ç”¨ `multiprocessing.Pool` å¹¶å‘å¤„ç†å¤šä¸ªä»»åŠ¡
- æ—¥å¿—è®°å½•æ¯å¼ å›¾æ˜¯å¦æˆåŠŸåŠå¤„ç†è€—æ—¶

### ğŸ”§ ä¸»è¦å‘½ä»¤è°ƒç”¨

```python
subprocess.run([
    "iopaint", "run",
    "--model", "lama",
    "--device", "cpu",           # æ˜ç¡®ä½¿ç”¨ CPUï¼Œå…¼å®¹æ€§å¥½
    "--image", input_path,
    "--mask", mask_path,
    "--output", output_dir
])
````

---

## äº”ã€ä½¿ç”¨è¯´æ˜

### 1. ç¯å¢ƒå®‰è£…ï¼ˆæ—  Anacondaï¼Œçº¯ pipï¼‰

ç¡®ä¿å·²å®‰è£… Python 3.9/3.10ï¼Œå¹¶æ·»åŠ åˆ° PATHï¼š

```bash
pip install torch torchvision
pip install iopaint
```

> æ— éœ€ GPUã€CUDAï¼Œç›´æ¥ä½¿ç”¨ CPU å³å¯ã€‚

### 2. æ‰§è¡Œè„šæœ¬

å°†å›¾ç‰‡æ”¾å…¥ `input/`ï¼Œæ©è†œå‘½åä¸º `fixed_mask.jpg`ï¼Œè¿è¡Œå‘½ä»¤ï¼š

```bash
python parallel_iopaint.py
```

æ‰€æœ‰å›¾ç‰‡å°†è‡ªåŠ¨å¤„ç†ï¼Œè¾“å‡ºä¿å­˜åœ¨ `output/`ï¼Œæ—¥å¿—è®°å½•å†™å…¥ `process.log`ã€‚

## è§†é¢‘ç‰ˆæœ¬

- [å“”å“©å“”å“©](https://space.bilibili.com/3546607630944387)
- [YouTube](https://www.youtube.com/@itxiaozhang)